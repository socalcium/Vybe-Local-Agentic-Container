{% extends "base_page.html" %}

{% block title %}Orchestrator Settings{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
<style>
.orchestrator-settings {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.model-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.orchestrator-model-card {
    background: var(--card-background);
    border: 2px solid transparent;
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.orchestrator-model-card:hover {
    border-color: var(--accent-color);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.orchestrator-model-card.selected {
    border-color: var(--success-color);
    background: linear-gradient(135deg, var(--card-background) 0%, rgba(76, 175, 80, 0.1) 100%);
}

.orchestrator-model-card.recommended {
    border-color: var(--warning-color);
    background: linear-gradient(135deg, var(--card-background) 0%, rgba(255, 193, 7, 0.1) 100%);
}

.model-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.model-title {
    font-size: 1.2em;
    font-weight: 600;
    margin: 0;
    color: var(--text-primary);
}

.model-tier {
    background: var(--accent-color);
    color: white;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.8em;
    font-weight: 500;
}

.model-description {
    color: var(--text-secondary);
    margin: 10px 0;
    line-height: 1.5;
}

.model-specs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin: 15px 0;
}

.spec-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    background: var(--background-secondary);
    border-radius: 6px;
    font-size: 0.9em;
}

.spec-label {
    font-weight: 500;
    color: var(--text-secondary);
}

.spec-value {
    color: var(--text-primary);
    font-weight: 600;
}

.model-badges {
    display: flex;
    gap: 8px;
    margin: 15px 0;
    flex-wrap: wrap;
}

.model-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.75em;
    font-weight: 500;
}

.badge-uncensored {
    background: rgba(255, 82, 82, 0.2);
    color: #ff5252;
}

.badge-installed {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
}

.badge-not-installed {
    background: rgba(255, 152, 0, 0.2);
    color: #ff9800;
}

.badge-recommended {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
}

.capabilities-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin: 10px 0;
}

.capability-tag {
    background: var(--accent-color-fade);
    color: var(--accent-color);
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.75em;
    font-weight: 500;
}

.system-profile {
    background: var(--card-background);
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
}

.profile-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 15px 0;
}

.profile-item {
    text-align: center;
    padding: 15px;
    background: var(--background-secondary);
    border-radius: 8px;
}

.profile-value {
    font-size: 1.5em;
    font-weight: 600;
    color: var(--accent-color);
    margin-bottom: 5px;
}

.profile-label {
    color: var(--text-secondary);
    font-size: 0.9em;
}

.recommendations-section {
    background: var(--card-background);
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
}

.recommendation-item {
    display: flex;
    align-items: center;
    padding: 12px;
    margin: 8px 0;
    background: var(--background-secondary);
    border-radius: 8px;
}

.recommendation-icon {
    font-size: 1.2em;
    margin-right: 12px;
}

.config-section {
    background: var(--card-background);
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
}

.config-toggle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid var(--border-color);
}

.config-toggle:last-child {
    border-bottom: none;
}

.config-description {
    color: var(--text-secondary);
    font-size: 0.9em;
    margin-top: 5px;
}

.status-indicator {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 8px;
}

.status-online {
    background: #4caf50;
}

.status-offline {
    background: #f44336;
}

.status-warning {
    background: #ff9800;
}

@media (max-width: 768px) {
    .model-grid {
        grid-template-columns: 1fr;
    }
    
    .profile-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .model-specs {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="orchestrator-settings">
    <div class="page-header">
        <h1>üß† Orchestrator Settings</h1>
        <p>Configure the AI brain that manages your Vybe experience. The orchestrator analyzes your requests, manages resources, and provides personalized assistance.</p>
    </div>

    <!-- System Profile -->
    <div class="system-profile">
        <h2>üñ•Ô∏è System Profile</h2>
        <div class="profile-grid" id="systemProfile">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Current Status -->
    <div class="config-section">
        <h2>üìä Current Status</h2>
        <div id="currentStatus">
            <div class="loading-state">
                <div class="loading-spinner"></div>
                <p>Loading orchestrator status...</p>
            </div>
        </div>
    </div>

    <!-- Model Selection -->
    <div class="config-section">
        <h2>ü§ñ Orchestrator Model Selection</h2>
        <p>Choose the AI model that will orchestrate your Vybe experience. More capable models provide better decision-making but require more resources.</p>
        
        <div class="model-grid" id="orchestratorModels">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Personalization Settings -->
    <div class="config-section">
        <h2>üë§ Personalization & Learning</h2>
        <div class="config-toggle">
            <div>
                <strong>Enable Personalization</strong>
                <div class="config-description">Allow the orchestrator to learn from your interactions and provide personalized recommendations</div>
            </div>
            <label class="switch">
                <input type="checkbox" id="personalizationEnabled" checked>
                <span class="slider round"></span>
            </label>
        </div>
        
        <div class="config-toggle">
            <div>
                <strong>User RAG System</strong>
                <div class="config-description">Build a personalized knowledge base from your interactions for better assistance</div>
            </div>
            <label class="switch">
                <input type="checkbox" id="userRagEnabled" checked>
                <span class="slider round"></span>
            </label>
        </div>
        
        <div class="config-toggle">
            <div>
                <strong>Auto-Install Requirements</strong>
                <div class="config-description">Automatically check and install missing components for features</div>
            </div>
            <label class="switch">
                <input type="checkbox" id="autoInstallRequirements" checked>
                <span class="slider round"></span>
            </label>
        </div>
        
        <div class="config-toggle">
            <div>
                <strong>Hardware Optimization</strong>
                <div class="config-description">Automatically optimize model selection based on your hardware capabilities</div>
            </div>
            <label class="switch">
                <input type="checkbox" id="hardwareOptimization" checked>
                <span class="slider round"></span>
            </label>
        </div>
    </div>

    <!-- Requirements Status -->
    <div class="config-section">
        <h2>üîß Requirements Status</h2>
        <p>Status of all Vybe features and their requirements:</p>
        <div id="requirementsStatus">
            <button class="btn btn-primary" onclick="checkRequirements()">
                <i class="fas fa-sync-alt"></i> Check Requirements
            </button>
            <button class="btn btn-secondary" onclick="runIntegrationTests()" style="margin-left: 10px;">
                <i class="fas fa-flask"></i> Run Full Integration Test
            </button>
        </div>
    </div>

    <!-- Integration Test Results -->
    <div class="config-section" id="integrationTestSection" style="display: none;">
        <h2>üß™ Integration Test Results</h2>
        <div id="integrationTestResults">
            <!-- Results will be populated by JavaScript -->
        </div>
    </div>

    <!-- Personalized Recommendations -->
    <div class="recommendations-section">
        <h2>üí° Personalized Recommendations</h2>
        <div id="personalizedRecommendations">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Advanced Settings -->
    <div class="config-section">
        <h2>‚öôÔ∏è Advanced Settings</h2>
        <div class="form-group">
            <label for="orchestratorTemperature">Decision Temperature</label>
            <input type="range" id="orchestratorTemperature" min="0.1" max="1.0" step="0.1" value="0.3">
            <div class="range-value">0.3 (Balanced)</div>
            <small>Lower values make more consistent decisions, higher values are more creative</small>
        </div>
        
        <div class="form-group">
            <label for="delegationThreshold">Delegation Confidence Threshold</label>
            <input type="range" id="delegationThreshold" min="0.5" max="1.0" step="0.1" value="0.7">
            <div class="range-value">0.7 (Balanced)</div>
            <small>Minimum confidence required before delegating tasks to specialized models</small>
        </div>
    </div>
</div>

<!-- Model Details Modal -->
<div id="modelDetailsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalModelName">Model Details</h3>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body" id="modalModelDetails">
            <!-- Will be populated by JavaScript -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Close</button>
            <button class="btn btn-primary" id="selectModelBtn" onclick="selectModel()">Select This Model</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/modules/orchestrator-manager.js') }}"></script>
<script>
// Initialize orchestrator settings
document.addEventListener('DOMContentLoaded', function() {
    initializeOrchestratorSettings();
});
</script>
{% endblock %}
